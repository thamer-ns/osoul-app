# app.py
import streamlit as st
import pandas as pd
from styles import apply_custom_css  # استدعاء ملف التنسيق الجديد
from views import display_metrics, display_open_positions
# from analytics import ... (استدعاء دوال التحليل الخاصة بك كما هي)
# from database import ...

# إعداد الصفحة (يجب أن يكون أول سطر)
st.set_page_config(
    page_title="مدير المحفظة",
    layout="wide",
    initial_sidebar_state="collapsed" # إخفاء القائمة الجانبية لتركيز أكبر
)

def main():
    # 1. تطبيق التنسيقات (الخطوط، الألوان، RTL)
    apply_custom_css()

    st.title("لوحة المعلومات المالية")

    # هنا يتم استدعاء البيانات (افترض أن لديك كود جلب البيانات هنا)
    # df_portfolio = ... (احصل على الداتا فريم من التحليل)
    # total_assets = ...
    
    # مثال بيانات وهمية للتجربة (احذف هذا الجزء عند ووضعه في كودك الحقيقي)
    # ---------------------------------------------------------
    data = {
        'رمز الشركة': [1120, 2222, 4200],
        'اسم الشركة': ['الراجحي', 'أرامكو', 'الدريس'],
        'تاريخ الشراء': ['2023-10-01', '2024-01-15', '2023-05-20'],
        'الكمية': [500, 1200, 300],
        'متوسط التكلفة': [75.50, 32.10, 110.00],
        'السعر الحالي': [88.20, 31.50, 145.00],
        'القطاع': ['بنوك', 'طاقة', 'طاقة'], # هذا سيتم تجاهله
        'تاريخ البيع': [None, None, None]     # هذا سيتم تجاهله
    }
    df = pd.DataFrame(data)
    # حسابات بسيطة للعرض
    df['القيمة السوقية'] = df['الكمية'] * df['السعر الحالي']
    df['الربح/الخسارة'] = (df['السعر الحالي'] - df['متوسط التكلفة']) * df['الكمية']
    df['نسبة الربح %'] = ((df['السعر الحالي'] - df['متوسط التكلفة']) / df['متوسط التكلفة']) * 100
    
    total_assets = df['القيمة السوقية'].sum()
    total_pl = df['الربح/الخسارة'].sum()
    daily_change = 1250.50 # رقم افتراضي
    # ---------------------------------------------------------

    # 2. عرض الملخص
    display_metrics(total_assets, total_pl, daily_change)

    # 3. عرض الجدول (سيقوم تلقائياً بتنظيف الأعمدة وتنسيقها)
    display_open_positions(df)

if __name__ == "__main__":
    main()
